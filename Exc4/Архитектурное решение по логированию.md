# Архитектурное решение по логированию

## Мотивация
1. Сокращение времени на поиск и выявление ошибки
2. Возможность разобрать сложные ошибки (которые воспропроизводятся не стабильно)
   
## Планирование логирования
Для логирования в первую очередь выбираются сервисы, задействованные в процессах Получения и Обработки заказа.
Сервисы для логирования Shop API, CRM API, MES API, Messages Queue 
Т.е. те сервисы, которые были задествованы в Трейинге

Остальные сервисы логировать во вторую очередь. Следует отметить, что логи этих сервисов играют не маловажную роль и также помогут в разборе ошибок системы.

Стратегия логирования - по всем сервисам собираем обязательно ошибки, помечая уровнем Error
Для основных сервисов и функций получения и обработки заказа логируем INFO

В инфо требуется отправлять идентификатор заказа (ключ, по которому определяется заказ (ID или номер заказа)) - цель: сопостовление с трассировкой, быстрый поиск истории заказа

В логе требуется отражать текущее состояние заказа, выполняемое действие с заказааом.

Лог должен быть на входе в функцию (до начала обработки) и на выходе с результатом обработки. В случае ошибки получаем INFO о начале обработки и следом Error.

Предполагается, что запись лога содержит временные метки - сможем расситать длительность выполнения функуии и ранжировать записи в порядке исполнения функций.
Предполагается, что в лог обязательно передается название функции и название сервиса, идентификатор инстанса, номер потока и пр. информация о выполняющем сервисе.

Требования: 
1. логирование не должно значимо влиять на производительность системы
2. должно быть обесречено хранение логов определенное вреимя
3. быстрый поиск по индексам/ключам
4. возможность анализа логов
5. Как плюс - базове настройки правил на возникновения ошибок или иных стуаций, оповежение, визуализация
6. Как плюс - фильры, позволяющие маскировать данные
7. Как плюс - система аутентификации и авторизауии и Ролевая модель

Стратегия реагирвоания на события:
В случае возникновения логической ошибки с заказом следует предпринять меры к восстановлению заказа - расписать в зависимости от места возникновения ошибки какие действия предпринять.
Кто делает: Администратор/Оператор

В случае возникновения непредвиденной ошибки администратор анализирует проблему и по необходимости подключает команду производства.

Также, по результатам разбора ошибки стратегия реагирования дополняется. Ошибка может стать логической (предусмотренной) с описанием чего следует предпринять и реакция на возникновение подобных ошибок в будущем может быть передано Оператору/Продавцу.
Либо прична ошибки должна быть устранена и не будет воспроизводитсья в будущем.

## Предлагаемое решение

Какие системы использовать для логирвоания будут приниматься по сл. критериям
0. тех. стек/решение решает поставленную задачу
1. знания команды о тех. стэке, комьюнити стэка, распространенность
2. стоимость решения / опенсорс решение
3. требуемое оборудование/ресурсы
4. аффект на производительность системы

По критерию 1 - ELK
Остальные криетерии не были рассмотрены.
Выбираем ELK

Реализация:
1. Разворачивание ELK
2. Настрока индекса по ID или Номер Заказа 
3. Подключение Сервисов к сбору логов по схеме Push (в out)
4. Доработка сревисов на отправку сообщений типа INFO о заказах
5. Доработка сревисов на отправку сообщений типа ERROR о логических ошибках
6. Настройка отправки сообщений типа ERROR в случае возникновения непредусмотренных ошибок



## Cистема анализа логов

Настройка правила:
1. При возникновении ошибки при обработке заказа (есть входное Info и за ним Error) направлять уведомление администратору об ошибке. В дальнейшем, при уточнении правила, возможно отправить и оператору.
2. Возникновение массового количества ошибок от одного сервиса (по идее данная метрика будет видна в Мониторинге и реакция на нее должна быть там) - оповещение администратора или применение circut breaker / backpreassure 
Возможны более хитрые правила, которые будут инициировать переключение между инстансами сервиса или поднятие нового инстанса - требуются исследования и типизация ошибок. 
3. Неправильные вводы паролей - как вариант - блокировка IP, иные попытки взлома, которые неотлавлвивает мониторинг

Ошибки типа DDoS дожны выявляться на этапе Мониторинга и там принматься решения о защите системы


## Дополнительное задание
Задание пропускаю
